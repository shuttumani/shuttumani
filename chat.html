<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shuttumani Private Chat</title>

  <style>
    :root{
      --bg:#07070b;
      --card:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.12);
      --txt:#f6f6f8;
      --mut:rgba(255,255,255,.65);
      --pink:#ff4da6;
      --pink2:#ff7ac2;
      --ok:#2cff73;
      --bad:#ff3b3b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui, Segoe UI, Roboto, Arial;
      color:var(--txt);
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(255,77,166,.18), transparent 55%),
        radial-gradient(700px 500px at 80% 20%, rgba(120,80,255,.16), transparent 55%),
        radial-gradient(900px 600px at 50% 90%, rgba(0,255,140,.08), transparent 55%),
        var(--bg);
      min-height:100vh;
      padding:18px;
    }

    .wrap{max-width:980px;margin:0 auto;}
    .glass{
      background:var(--card);
      border:1px solid var(--stroke);
      border-radius:18px;
      box-shadow:0 12px 40px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
    }
    .topbar{
      position:sticky; top:0; z-index:10;
      padding:14px;
      margin-bottom:14px;
    }
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px}
    .avatar{
      width:42px;height:42px;border-radius:50%;
      background:linear-gradient(135deg,var(--pink),#7f66ff);
      display:grid;place-items:center;font-weight:950;
    }
    .title{font-weight:950}
    .sub{font-size:12px;color:var(--mut);margin-top:2px}

    .status{
      display:flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.25);
      font-size:12px;color:var(--mut);
      white-space:nowrap;
    }
    .dot{width:10px;height:10px;border-radius:50%;background:var(--bad);box-shadow:0 0 14px rgba(255,59,59,.35)}
    .dot.ok{background:var(--ok);box-shadow:0 0 14px rgba(44,255,115,.35)}

    .panel{padding:16px}
    h1{margin:0 0 6px;font-size:26px}
    p{margin:0;color:var(--mut);line-height:1.6}
    .field{display:grid;gap:10px;margin-top:14px}
    input{
      width:100%;
      padding:13px 14px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.25);
      color:var(--txt);
      outline:none;
      font-size:15px;
    }
    input:focus{border-color:rgba(255,77,166,.55);box-shadow:0 0 0 3px rgba(255,77,166,.12)}
    .btn{
      border:none; cursor:pointer;
      padding:13px 14px;
      border-radius:14px;
      font-weight:950;
      color:white;
      background:linear-gradient(135deg,var(--pink),var(--pink2));
      box-shadow:0 10px 25px rgba(255,77,166,.22);
    }
    .btn.ghost{
      background:rgba(255,255,255,.07);
      border:1px solid var(--stroke);
      box-shadow:none;
    }
    .mini{font-size:12px;color:var(--mut);margin-top:8px}
    .msg{font-size:13px;margin-top:10px;font-weight:900}
    .good{color:var(--ok)} .bad{color:var(--bad)}
    .hide{display:none !important;}

    /* chat */
    #msgs{
      height:58vh;
      overflow:auto;
      padding:14px;
    }
    .bubble{
      max-width:78%;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      margin:10px 0;
      box-shadow:0 8px 25px rgba(0,0,0,.25);
      word-wrap:break-word;
    }
    .me{margin-left:auto;background:rgba(255,77,166,.14);border-color:rgba(255,77,166,.35)}
    .meta{font-size:11px;color:rgba(255,255,255,.6);margin-top:6px}

    .bar{
      position:sticky; bottom:0;
      padding:14px;
      background: linear-gradient(to top, rgba(7,7,11,.92), rgba(7,7,11,0));
    }
    .barInner{
      display:flex;gap:10px;align-items:center;
      padding:12px;border-radius:18px;
      border:1px solid var(--stroke);
      background:rgba(0,0,0,.25);
    }
    .barInner input{flex:1;border:none;background:transparent;padding:10px 8px}
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topbar glass">
      <div class="row">
        <div class="brand">
          <div class="avatar">S</div>
          <div>
            <div class="title">Shuttumani ðŸ’—</div>
            <div class="sub" id="smallLine">Private chat</div>
          </div>
        </div>

        <div class="row" style="gap:10px">
          <div class="status">
            <div id="onlineDot" class="dot"></div>
            <div id="onlineText">She: offline</div>
          </div>
          <button id="logoutBtn" class="btn ghost hide">Logout</button>
        </div>
      </div>
    </div>

    <!-- LOCK -->
    <section id="lockBox" class="glass panel">
      <h1>Unlock ðŸ”’</h1>
      <p>Enter our secret date to open.</p>

      <div class="field">
        <input id="lockInput" inputmode="numeric" maxlength="8" placeholder="01032025" />
        <button id="unlockBtn" class="btn" type="button">Unlock</button>
      </div>

      <div class="mini">Hint: DDMMYYYY</div>
      <div id="lockMsg" class="msg"></div>
    </section>

    <!-- LOGIN -->
     <section id="loginBox" class="hide">
      <h1>Login ðŸ’ž</h1>
      <p>Enter email & password.</p>

      <div class="field">
        <input id="email" placeholder="Email" autocomplete="username">
        <input id="pass" type="password" placeholder="Password" autocomplete="current-password">
        <button id="loginBtn" class="btn" type="button">Login</button>
      </div>

      <div id="loginMsg" class="msg"></div>
    </section>

    <!-- CHAT -->
    <section id="chatBox" class="hide">
      <div class="panel">
        <div style="font-weight:950;font-size:18px">ðŸ’¬ Our Room</div>
        <div class="sub" id="whoLine">Signed inâ€¦</div>
      </div>
      <div style="height:1px;background:rgba(255,255,255,.10)"></div>

      <div id="msgs"></div>

      <div class="bar">
        <div class="barInner">
          <input id="msgInput" placeholder="Type messageâ€¦" />
          <button id="sendBtn" class="btn" type="button">Send</button>
        </div>
        <div class="mini">Online shows only when she opens this page.</div>
      </div>
    </section>

  </div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

  // âœ… your firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDJ5nrd-sCZNvCsg3THxXhewT0cBzkDoCI",
    authDomain: "shuttumani-chat.firebaseapp.com",
    projectId: "shuttumani-chat",
    storageBucket: "shuttumani-chat.firebasestorage.app",
    messagingSenderId: "1033302224383",
    appId: "1:1033302224383:web:952bdfed407ab257cf0bca"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // IDs
  const ROOM_ID = "our-room";

  // UI
  const loginBox = document.getElementById("loginBox");
  const chatBox  = document.getElementById("chatBox");

  const emailEl  = document.getElementById("email");
  const passEl   = document.getElementById("pass");
  const loginBtn = document.getElementById("loginBtn");

  const msgs     = document.getElementById("msgs");
  const msgInput = document.getElementById("msgInput");
  const sendBtn  = document.getElementById("sendBtn");

  // Simple show/hide
  const show = (el) => el && el.classList.remove("hide");
  const hide = (el) => el && el.classList.add("hide");

  // LOGIN
  loginBtn?.addEventListener("click", async () => {
    try {
      await signInWithEmailAndPassword(auth, emailEl.value.trim(), passEl.value);
    } catch (e) {
      alert("Login failed: " + (e.code || e.message));
      console.log(e);
    }
  });

  // SEND MESSAGE
  async function sendMsg(){
    const text = (msgInput.value || "").trim();
    if(!text) return;

    msgInput.value = "";
    try {
      await addDoc(collection(db, "rooms", ROOM_ID, "messages"), {
        text,
        email: auth.currentUser?.email || "unknown",
        createdAt: serverTimestamp()
      });
    } catch (e) {
      alert("Send failed: " + (e.code || e.message));
      console.log(e);
    }
  }

  sendBtn?.addEventListener("click", sendMsg);
  msgInput?.addEventListener("keydown", (e) => { if(e.key === "Enter") sendMsg(); });

  // LISTEN MESSAGES
  function startListening(){
    const q = query(
      collection(db, "rooms", ROOM_ID, "messages"),
      orderBy("createdAt", "asc"),
      limit(200)
    );

    onSnapshot(q, (snap) => {
      msgs.innerHTML = "";
      snap.forEach((docu) => {
        const m = docu.data();
        const div = document.createElement("div");
        div.className = "bubble" + (m.email === auth.currentUser?.email ? " me" : "");
        div.innerHTML = `
          <div>${escapeHtml(m.text || "")}</div>
          <div class="meta">${escapeHtml(m.email || "")}</div>
        `;
        msgs.appendChild(div);
      });
      msgs.scrollTop = msgs.scrollHeight;
    }, (err) => {
      alert("Listen error: " + (err.code || err.message));
      console.log(err);
    });
  }

  function escapeHtml(s){
    return (s||"").replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  // AUTH STATE
  onAuthStateChanged(auth, (user) => {
    if(!user){
      show(loginBox);
      hide(chatBox);
      msgs.innerHTML = "";
      return;
    }
    hide(loginBox);
    show(chatBox);
    startListening();
  });
</script>

</body>
  </html>
